 Requires Outlook to be installed
$Outlook = New-Object -ComObject Outlook.Application
$Namespace = $Outlook.GetNamespace("MAPI")

# --- Define your new profile and account details ---
$ProfileName = "MyNewProfile" # Name for your new profile
$EmailAddress = "user@example.com" # Your email address

# --- Create the profile and account ---
# (Error handling for existing profiles/accounts might be needed)
try {
    $Profile = $Namespace.Profiles | Where-Object {$_.Name -eq $ProfileName}
    if ($Profile -eq $null) {
        $Profile = $Namespace.Profiles.Add($ProfileName)
        Write-Host "Profile '$ProfileName' created."
    }
    $Account = $Namespace.Folders.AddExchangeMailbox($EmailAddress)
    $Account.Display() # This might prompt for credentials
    $Profile.Save()
    Write-Host "Account for '$EmailAddress' added to '$ProfileName'."
} catch {
    Write-Error "Error creating profile or account: $($_.Exception.Message)"
} finally {
    # Clean up COM objects (optional but good practice)
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($Namespace) | Out-Null
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($Outlook) | Out-Null
}
